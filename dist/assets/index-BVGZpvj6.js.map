{"version":3,"file":"index-BVGZpvj6.js","sources":["../../src/loader.js","../../src/kaplay.js","../../src/utils/utils.js","../../src/scenes/lose.js","../../src/utils/animations.js","../../src/components/charactergui.js","../../src/objects/player.js","../../src/utils/difficulty.js","../../src/objects/shields.js","../../src/objects/enemy.js","../../src/scenes/game.js","../../src/scenes/menu.js","../../src/main.js"],"sourcesContent":["import { k } from \"./kaplay\";\nimport { GameState } from \"./main\";\n\nconst colorPalettes = [\n  [139, 200, 254],\n  [207, 171, 74],\n  [244, 78, 56],\n  [0, 255, 174],\n  [166, 146, 176],\n];\n\nconst colorHistory = [];\n\nexport function setTintColor() {\n  // available indices that are not in last 2\n  const options = colorPalettes\n    .map((_, i) => i)\n    .filter((i) => !colorHistory.includes(i));\n\n  // pick a random index\n  const colorIndex = options[Math.floor(Math.random() * options.length)];\n\n  // update history\n  colorHistory.push(colorIndex);\n  if (colorHistory.length > 2) colorHistory.shift();\n\n  // store raw RGB in GameState\n  //GameState.tintColor = colorPalettes[colorIndex];\n\n  const [r, g, b] = colorPalettes[colorIndex].map((v) => v / 255);\n\n  k.usePostEffect(\"tint\", () => ({\n    u_color: k.rgb(r, g, b),\n  }));\n}\n\nexport function loadAssets() {\n  k.loadRoot(\"./\"); // A good idea for Itch.io publishing later\n\n  k.loadShader(\n    \"tint\",\n    null,\n    `\n    uniform vec3 u_color;\n\n    vec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {\n        vec4 c = def_frag();\n        return vec4(u_color.x * c.r,\n          u_color.y * c.g,\n          u_color.z * c.b,\n          c.a);\n    }\n  `,\n  );\n\n  setTintColor();\n\n  k.loadBitmapFont(\"Alkhemikal\", \"fonts/Alkhemikal.png\", 24, 32, {\n    filter: \"nearest\",\n    chars:\n      \" !\\\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\\\]^_`abcdefghijklmnopqrstuvwxyz{|}~\",\n  });\n\n  k.loadBitmapFont(\"NameHere\", \"fonts/NameHere.png\", 24, 32, {\n    filter: \"nearest\",\n    chars:\n      \" !\\\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\\\]^_`abcdefghijklmnopqrstuvwxyz{|}~\",\n  });\n\n  k.loadBitmapFont(\"Numbers\", \"fonts/Number.png\", 30, 30, {\n    filter: \"nearest\",\n    chars: \" #$%'()*+,-./0123456789:<=>\",\n  });\n\n  k.loadBitmapFont(\"Classic\", \"fonts/ClassicShit.png\", 30, 30, {\n    filter: \"nearest\",\n    chars:\n      \" !&'()*+,.0123456789:;=?ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\",\n  });\n\n  k.loadFont(\"Menu\", \"fonts/MenuCard.ttf\");\n\n  k.loadSprite(\"TITLE\", \"sprites/title.png\");\n\n  k.loadSpriteAtlas(\"sprites/projectile-sheet.png\", {\n    bullet: {\n      x: 0,\n      y: 0,\n      width: 48,\n      height: 16,\n      sliceX: 3,\n      anims: {\n        play: {\n          from: 0,\n          to: 2,\n          loop: true,\n          speed: 24,\n        },\n      },\n    },\n  });\n\n  k.loadSpriteAtlas(\"sprites/gui-sheet.png\", {\n    diamond: {\n      x: 0,\n      y: 0,\n      width: 16,\n      height: 16,\n    },\n    point: {\n      x: 16,\n      y: 0,\n      width: 48,\n      height: 16,\n      sliceX: 3,\n    },\n    RIP: {\n      x: 0,\n      y: 16,\n      width: 16,\n      height: 16,\n    },\n    border: {\n      x: 48,\n      y: 0,\n      width: 32,\n      height: 32,\n      slice9: {\n        left: 6,\n        right: 6,\n        top: 6,\n        bottom: 6,\n      },\n    },\n    restart: {\n      x: 16,\n      y: 16,\n      width: 16,\n      height: 16,\n    },\n    inputs: {\n      x: 0,\n      y: 32,\n      width: 80,\n      height: 16,\n      sliceX: 5,\n    },\n  });\n\n  k.loadSpriteAtlas(\"sprites/tileset.png\", {\n    hero: {\n      x: 16,\n      y: 0,\n      width: 16,\n      height: 16,\n    },\n    crown: {\n      x: 0,\n      y: 0,\n      width: 16,\n      height: 16,\n    },\n    shield: {\n      x: 0,\n      y: 16,\n      width: 64,\n      height: 32,\n      sliceX: 4,\n      sliceY: 2,\n    },\n  });\n\n  k.loadSpriteAtlas(\"sprites/fx-sheet.png\", {\n    explode: {\n      x: 0,\n      y: 0,\n      width: 96,\n      height: 16,\n      sliceX: 6,\n      anims: {\n        play: {\n          from: 0,\n          to: 5,\n          speed: 12,\n        },\n      },\n    },\n    hit: {\n      x: 0,\n      y: 16,\n      width: 64,\n      height: 16,\n      sliceX: 4,\n      anims: {\n        play: {\n          from: 0,\n          to: 3,\n          speed: 12,\n        },\n      },\n    },\n    particle: {\n      x: 64,\n      y: 16,\n      width: 32,\n      height: 16,\n      sliceX: 2,\n    },\n  });\n\n  k.loadSprite(\"bg0\", \"map/backgrounds/png/Level_0.png\");\n  k.loadSound(\"music\", \"sounds/ReClaimed.mp3\");\n}\n","import kaplay from \"kaplay\";\nimport { loadAssets } from \"./loader\";\n\n// import \"kaplay/global\"; // uncomment if you want to use without the k. prefix\n\nexport const k = kaplay({\n  global: false,\n  //width: 240,\n  //height: 208,\n  scale: 4,\n  font: \"NameHere\",\n  crisp: true,\n  texFilter: \"nearest\",\n  loadingScreen: true,\n  background: [10, 10, 20],\n  debug: true,\n  buttons: {\n    primary: {\n      keyboard: [\"x\", \"up\"],\n      gamepad: [\"south\"],\n      mouse: [\"left\"],\n    },\n    secondary: {\n      keyboard: [\"z\", \"left\"],\n      gamepad: [\"west\"],\n      mouse: [\"right\"],\n    },\n  },\n});\n\nloadAssets();\n\nk.onLoading((progress) => {\n  /*k.drawSprite({\n    sprite: \"TITLE\",\n    anchor: \"center\",\n    pos: k.vec2(k.center().x, k.center().y + 16),\n  });*/\n\n  k.drawText({\n    text: (Math.floor(progress) + \" %\").toString(),\n    size: 10,\n    width: 120,\n    anchor: \"center\",\n    align: \"center\",\n    letterSpacing: -2,\n    pos: k.center(),\n    color: k.WHITE,\n  });\n});\n","import { k } from \"../kaplay\";\n\nexport function getOffsetPosition(defaultOffset = 48) {\n  let offset = defaultOffset;\n\n  const maxDistance = 128;\n  const playArea = k.height() - offset * 2;\n\n  if (playArea > maxDistance) {\n    const areaDifference = playArea - maxDistance;\n\n    offset = offset + areaDifference / 2;\n  }\n\n  return offset;\n}\n\nexport function toRoman(num) {\n  const map = [\n    [1000, \"M\"],\n    [900, \"CM\"],\n    [500, \"D\"],\n    [400, \"CD\"],\n    [100, \"C\"],\n    [90, \"XC\"],\n    [50, \"L\"],\n    [40, \"XL\"],\n    [10, \"X\"],\n    [9, \"IX\"],\n    [5, \"V\"],\n    [4, \"IV\"],\n    [1, \"I\"],\n  ];\n\n  let result = \"\";\n  for (const [value, roman] of map) {\n    while (num >= value) {\n      result += roman;\n      num -= value;\n    }\n  }\n  return result;\n}\n","import { k } from \"../kaplay\";\nimport { GameState } from \"../main\";\n\nk.scene(\"over\", () => {\n  const restart = k.add([\n    k.sprite(\"restart\"),\n    k.pos(k.center().x, k.center().y + 48),\n    k.anchor(\"center\"),\n    k.area(),\n    k.layer(\"foreground\"),\n    \"restart\",\n  ]);\n\n  if (GameState.score > GameState.highscore)\n    GameState.highscore = GameState.score;\n\n  restart.onClick(() => {\n    GameState.score = 0;\n    GameState.mode = \"start\";\n    k.go(\"game\");\n  });\n\n  /*const bd = k.add([\n    k.sprite(\"border\"),\n    k.pos(k.vec2(pos.x - 0.1, pos.y)),\n    k.anchor(\"center\"),\n  ]);\n\n  bd.width = 36;\n  bd.height = 36;*/\n\n  k.onDraw(() => {\n    k.drawRect({\n      width: 200,\n      height: 150,\n      pos: k.center(),\n      anchor: \"center\",\n      fill: false,\n      outline: { color: k.WHITE, width: 1.5, join: \"miter\" },\n    });\n\n    k.drawSprite({\n      sprite: \"RIP\",\n      width: 24,\n      height: 24,\n      pos: k.vec2(k.center().x, k.center().y - 82),\n      anchor: \"center\",\n    });\n\n    k.drawText({\n      text: \"GAME OVER\",\n      font: \"Alkhemikal\",\n      anchor: \"center\",\n      align: \"center\",\n      pos: k.vec2(k.center().x, k.center().y - 44),\n      letterSpacing: -4,\n      size: 28,\n    });\n\n    k.drawText({\n      text: \"Score: \" + GameState.score,\n      anchor: \"center\",\n      align: \"center\",\n      pos: k.vec2(k.center().x, k.center().y - 16),\n      letterSpacing: -5,\n      size: 16,\n    });\n\n    k.drawText({\n      text: \"Highscore: \" + GameState.highscore,\n      anchor: \"center\",\n      align: \"center\",\n      pos: k.center(),\n      letterSpacing: -5,\n      size: 16,\n    });\n\n    k.drawText({\n      text: \"Kills: \" + GameState.enemiesBeaten,\n      anchor: \"center\",\n      align: \"center\",\n      pos: k.vec2(k.center().x, k.center().y + 18),\n      letterSpacing: -7,\n      size: 16,\n    });\n\n    // Retsrta Background\n    k.drawRect({\n      width: 24,\n      height: 24,\n      pos: k.vec2(k.center().x, k.center().y + 48),\n      anchor: \"center\",\n      fill: false,\n      outline: { color: k.WHITE, width: 1, join: \"miter\" },\n    });\n\n    k.drawText({\n      text: \"by FABRIC VISIONS\",\n      anchor: \"center\",\n      align: \"center\",\n      pos: k.vec2(k.center().x, k.center().y + 92),\n      letterSpacing: -2.8,\n      size: 8,\n      opacity: 0.4,\n    });\n  });\n});\n","import { k } from \"../kaplay\";\n\nexport function animateFadeToSpriteChange(sprite) {\n  k.tween(1, 0, 2, (p) => (opacityWaving = p), k.easings.linear).onEnd(() => {\n    if (controlSchemeFrame + 1 > k.getSprite(\"inputs\").frames) {\n      controlSchemeFrame = 0;\n    } else {\n      controlSchemeFrame += 1;\n    }\n    k.tween(0, 1, 2, (p) => (opacityWaving = p), k.easings.linear).onEnd(() => {\n      animateFadeToSpriteChange(sprite);\n    });\n  });\n}\n\nexport function animateShakingObject(obj, duration = 0.2, intensity = 3) {\n  const startX = obj.pos.x;\n\n  obj.tween(\n    0,\n    1,\n    duration,\n    (t) => {\n      // t goes from 0 â†’ 1 over `duration`\n      // multiply by frequency to get N oscillations per second\n      const angle = t * 10 * Math.PI * 2 * duration;\n      obj.pos.x = startX + Math.sin(angle) * intensity;\n    },\n    k.easings.easeOutCubic,\n  );\n}\n\nexport function animateFloatingObject(obj, backwards = false) {\n  obj.animate(\"pos\", [k.vec2(0), k.vec2(0, backwards ? 2 : -2)], {\n    duration: 1,\n    direction: \"ping-pong\",\n    easing: k.easings.easeInOutSine,\n  });\n}\n\nexport function animateSquashStretchObject(obj) {\n  obj.tween(\n    k.vec2(0.6, 1.2),\n    k.vec2(1),\n    1,\n    (value) => {\n      obj.scale = value;\n    },\n    k.easings.easeOutElastic,\n  );\n}\n","import { k } from \"../kaplay\";\nimport { animateSquashStretchObject } from \"../utils/animations\";\n\nexport function buildGUI(OPTIONS, number, maxNumber, mirror = false) {\n  const dir = mirror ? -1 : 1;\n\n  k.drawSprite({\n    sprite: \"diamond\",\n    pos: k.vec2(OPTIONS.xOffset * dir, 0),\n    anchor: \"center\",\n    flipX: mirror,\n  });\n\n  /*if (mirror) {\n    k.drawSprite({\n      sprite: \"diamond\",\n      pos: k.vec2((OPTIONS.xOffset - 17) * dir, 0),\n      anchor: \"center\",\n      flipX: false,\n    });\n    }*/\n\n  k.drawText({\n    text: number.toString(),\n    size: 14,\n    pos: k.vec2(OPTIONS.xOffset * dir + 0.3, -0.5),\n    anchor: \"center\",\n    align: \"center\",\n    font: \"Numbers\",\n    letterSpacing: -10,\n  });\n\n  // Sprites in a zig-zag way\n  for (let i = 0; i < maxNumber; i++) {\n    // base position\n    const baseX = dir * (OPTIONS.xOffset + 13);\n    const baseY = i * OPTIONS.spacing + 8;\n\n    // every odd index nudges X by a certain amount\n    const zigzagOffset = i % 2 === 0 ? 0 : OPTIONS.spacing;\n\n    k.drawSprite({\n      sprite: \"point\",\n      frame: i < number ? (mirror ? 1 : 0) : 2,\n      opacity: i < number ? 1 : 0.5,\n      pos: k.vec2(baseX - dir * zigzagOffset, dir * baseY),\n      anchor: \"center\",\n      //flipX: !mirror,\n    });\n  }\n}\n","import { k } from \"../kaplay\";\nimport { GameState } from \"../main\";\n\nimport {\n  animateFloatingObject,\n  animateSquashStretchObject,\n} from \"../utils/animations\";\nimport { buildGUI } from \"../components/charactergui\";\n\nexport function buildPlayer() {\n  // PARENT OBJECT\n  const object = k.add([\n    k.pos(GameState.xPosition, k.height() - GameState.yOffset),\n    k.anchor(\"center\"),\n    {\n      isAlive: true,\n      canShoot: false,\n      reloadSpeed: 10,\n      bulletSpeed: 3,\n      ammo: 5,\n      maxAmmo: 0,\n    },\n    \"player\",\n  ]);\n\n  object.maxAmmo = object.ammo;\n\n  // SPRITE ONLY SETUP\n  const sprite = object.add([\n    k.sprite(\"hero\"),\n    k.pos(),\n    k.animate({ relative: true }),\n    k.anchor(\"center\"),\n    k.timer(),\n    k.layer(\"game\"),\n    k.z(2),\n  ]);\n\n  animateFloatingObject(sprite);\n\n  // DRAW PLAYER AMMO\n  object.onDraw(() => {\n    if (GameState.mode !== \"game\") return;\n\n    buildGUI(GameState, object.ammo, object.maxAmmo, true);\n  });\n\n  // SHOOT PROJECTILE FUNCTION\n  // Creates a bullet\n  object.shoot = () => {\n    if (object.ammo > 0 && object.canShoot) {\n      object.ammo -= 1;\n      object.canShoot = false;\n\n      k.wait(0.1 * object.reloadSpeed, () => {\n        object.canShoot = true;\n      });\n\n      sprite.unanimate(\"pos\");\n      animateSquashStretchObject(sprite);\n\n      const bullet = k.add([\n        k.pos(object.pos),\n        k.sprite(\"bullet\", { anim: \"play\" }),\n        k.area({ scale: 0.4 }),\n        k.offscreen({ destroy: true }),\n        k.anchor(\"center\"),\n        k.move(k.UP, object.bulletSpeed * 30),\n        k.layer(\"game\"),\n        \"bullet\",\n      ]);\n\n      function collide() {\n        bullet.unuse(\"move\");\n        bullet.o;\n\n        bullet.sprite = \"hit\";\n        bullet.play(\"play\");\n\n        bullet.onAnimEnd((anim) => {\n          bullet.destroy();\n        });\n      }\n\n      bullet.onCollide(\"shield\", () => {\n        collide();\n      });\n\n      bullet.onCollide(\"crown\", () => {\n        collide();\n      });\n\n      animateFloatingObject(sprite);\n    }\n  };\n\n  return object;\n}\n","// difficulties.js\nimport { k } from \"../kaplay\";\n\nconst DIFFICULTIES = {\n  TEST: {\n    health: () => 1,\n    shields: () => 1,\n    radius: () => 40,\n    speed: () => 0.3,\n    score: () => k.randi(8, 11),\n  },\n  easy: {\n    health: () => k.randi(3, 5),\n    shields: () => k.randi(3, 5),\n    radius: () => 40,\n    speed: () => k.rand(0.45, 0.7),\n    score: () => 3,\n  },\n  medium: {\n    health: () => k.randi(4, 6),\n    shields: () => k.randi(4, 6),\n    radius: () => 36,\n    speed: () => k.rand(1.1, 1.2),\n    score: () => k.randi(5, 8),\n  },\n  hard: {\n    health: () => k.randi(6, 9),\n    shields: () => k.randi(5, 7),\n    radius: () => 36,\n    speed: () => k.rand(1.4, 1.5),\n    score: () => k.randi(9, 12),\n  },\n  imposible: {\n    health: () => k.randi(9, 11),\n    shields: () => k.randi(6, 8),\n    radius: () => 32,\n    speed: () => k.rand(1.7, 1.8),\n    score: () => 16,\n  },\n};\n\nexport function getEnemyConfig(difficulty = \"easy\") {\n  const rules = DIFFICULTIES[difficulty];\n\n  return {\n    health: rules.health(),\n    shields: rules.shields(),\n    radius: rules.radius(),\n    speed: rules.speed(),\n    score: rules.score(),\n  };\n}\n","import { k } from \"../kaplay\";\nimport { animateSquashStretchObject } from \"../utils/animations\";\n\nexport function shieldSetup(object) {\n  const spriteFrame = k.randi(7);\n  const spriteFlip = spriteFrame != 4 && k.rand() < 0.5 ? true : false;\n\n  // SHIELDS SETUP\n  // And onUpdate constant movement/animation\n  for (let i = 0; i < object.shields; i++) {\n    const newShield = k.add([\n      k.sprite(\"shield\", {\n        frame: spriteFrame,\n        flipX: spriteFlip,\n      }),\n      k.anchor(\"center\"),\n      k.area({ scale: k.vec2(0.7, 0.7), offset: k.vec2(0, 1.2) }),\n      k.pos(object.pos),\n      k.timer(),\n      k.layer(\"game\"),\n      k.z(1),\n      \"shield\",\n    ]);\n\n    newShield.onCollide(\"bullet\", () => {\n      animateSquashStretchObject(newShield);\n    });\n\n    object.createdShields.push({ shield: newShield, index: i });\n  }\n\n  object.onUpdate(() => {\n    if (!object.has(\"health\")) return;\n    const t = k.time() * object.speed * object.direction;\n    object.createdShields.forEach(({ shield, index }, i) => {\n      const angle = ((2 * Math.PI) / object.shields) * i + t;\n      let offset = k.vec2(\n        Math.cos(angle) * object.radius,\n        Math.sin(angle) * object.radius,\n      );\n      shield.moveTo(object.pos.x + offset.x, object.pos.y + offset.y);\n    });\n  });\n\n  object.onDeath(() => {\n    object.createdShields.forEach(({ shield }, i) => {\n      k.wait(0.3 * i, () => {\n        shield.sprite = \"explode\";\n        shield.play(\"play\");\n\n        shield.onAnimEnd((anim) => {\n          shield.destroy();\n        });\n      });\n    });\n  });\n}\n","import { buildGUI } from \"../components/charactergui\";\nimport { k } from \"../kaplay\";\nimport { GameState } from \"../main\";\nimport {\n  animateFloatingObject,\n  animateShakingObject,\n  animateSquashStretchObject,\n} from \"../utils/animations\";\nimport { getEnemyConfig } from \"../utils/difficulty\";\nimport { shieldSetup } from \"./shields\";\n\nexport function buildEnemy({ onDeath } = {}) {\n  const stats = getEnemyConfig(GameState.difficulty);\n\n  // PARENT OBJECT\n  const object = k.add([\n    k.health(stats.health),\n    k.pos(GameState.xPosition, GameState.yOffset + 5),\n    k.area({ shape: new k.Rect(k.vec2(0), 16, 16) }),\n    k.anchor(\"center\"),\n    {\n      shields: stats.shields,\n      radius: stats.radius,\n      speed: stats.speed,\n      score: stats.score,\n      direction: k.rand() < 0.5 ? 1 : -1,\n      createdShields: [],\n    },\n    k.layer(\"game\"),\n    \"crown\",\n  ]);\n\n  // SPRITE ONLY SETUP\n  const sprite = object.add([\n    k.sprite(\"crown\"),\n    k.pos(),\n    k.anchor(\"center\"),\n    k.animate({ relative: true }),\n    k.timer(),\n    k.layer(\"game\"),\n    k.z(2),\n  ]);\n\n  animateFloatingObject(sprite, true);\n\n  // DRAW ENEMY HEALTH\n  object.onDraw(() => {\n    if (GameState.mode !== \"game\" || !object.has(\"health\")) return;\n\n    buildGUI(GameState, object.hp, object.maxHP);\n  });\n\n  shieldSetup(object);\n\n  object.onCollide(\"bullet\", () => {\n    animateShakingObject(sprite);\n    animateSquashStretchObject(sprite);\n    object.hp -= 1;\n  });\n\n  object.onDeath(() => {\n    object.unuse(\"health\");\n    k.shake(4);\n\n    const timer = 0.25 * object.createdShields.length + 1;\n\n    animateShakingObject(sprite, timer, 2);\n\n    GameState.particles.pos = object.pos;\n    k.loop(\n      0.25,\n      () => {\n        GameState.particles.emit(4);\n      },\n      object.createdShields.length + 1,\n    );\n\n    k.wait(timer, () => {\n      if (onDeath) onDeath(object);\n      object.destroy();\n    });\n  });\n\n  return object;\n}\n","import { k } from \"../kaplay\";\nimport { GameState } from \"../main\";\nimport \"./lose\";\nimport { buildPlayer } from \"../objects/player\";\nimport { buildEnemy } from \"../objects/enemy\";\nimport { toRoman } from \"../utils/utils\";\nimport { setTintColor } from \"../loader\";\n\nconst FloorState = {\n  currentFloor: 1,\n  currentRoom: 0,\n  totalRooms: k.randi(2, 5),\n};\n\nk.scene(\"game\", () => {\n  function setBackgroundPosition() {\n    return k.vec2(k.randi(4, 32 - wid - 4), k.randi(4, 32 - wid - 4));\n  }\n\n  let bg = \"bg\" + 0;\n  const wid = Math.floor(k.width() / 16 / 2);\n  let bgPos = setBackgroundPosition();\n\n  const ob = k.add([k.layer(\"background\")]);\n\n  ob.onDraw(() => {\n    k.drawSprite({\n      sprite: bg.toString(),\n      pos: k.vec2(bgPos.x * -16, bgPos.y * -16),\n      //anchor: \"center\",\n    });\n  });\n\n  const player = buildPlayer();\n  player.canShoot = true;\n\n  function spawnEnemy() {\n    const enemy = buildEnemy({\n      onDeath: (enemy) => {\n        FloorState.currentRoom += 1;\n        GameState.enemiesBeaten += 1;\n        //GameState.floor += 1;\n\n        if (FloorState.currentRoom >= FloorState.totalRooms) {\n          FloorState.currentRoom = 0;\n          GameState.floor += 1;\n          FloorState.totalRooms = k.randi(2, 5);\n        }\n\n        // Game-level reactions\n        k.tween(\n          GameState.score,\n          (GameState.score += enemy.score),\n          1,\n          (p) => (GameState.score = Math.ceil(p)),\n          k.easings.easeOutQuint,\n        );\n\n        k.wait(0.25, () => {\n          k.shader(5);\n          bgPos = setBackgroundPosition();\n          setTintColor();\n          spawnEnemy();\n        });\n      },\n    });\n  }\n\n  spawnEnemy();\n\n  k.onCollide(\"crown\", \"bullet\", (crown, bullet) => {\n    k.shake(1);\n    player.ammo += 1;\n  });\n\n  k.onCollide(\"shield\", \"bullet\", (shield, bullet) => {\n    k.shake(1);\n  });\n\n  k.onUpdate(() => {\n    if (player.ammo === 0 && k.get(\"bullet\").length <= 0 && player.isAlive) {\n      //console.log(\"loser\");\n      //animateShakingObject(sprite, timer, 2);\n\n      player.isAlive = false;\n      k.shake(6);\n      GameState.particles.pos = player.pos;\n\n      k.loop(\n        0.2,\n        () => {\n          GameState.particles.emit(4);\n        },\n        6,\n      ).onEnd(() => {\n        GameState.mode = \"over\";\n      });\n    }\n  });\n\n  function shootProjectile() {\n    if (GameState.mode === \"start\") {\n      GameState.mode = \"game\";\n      k.play(\"music\", { loop: true });\n    } else {\n      player.shoot();\n    }\n  }\n\n  let isrec = false;\n  let rec;\n  k.onButtonPress(\"secondary\", () => {\n    /*if (isrec == false) {\n      isrec = true;\n\n      rec = k.record();\n      console.log(\"record\");\n    } else {\n      isrec = false;\n      rec.download();\n      console.log(\"download\");\n    }*/\n  });\n\n  k.onButtonDown(\"primary\", () => {\n    shootProjectile();\n  });\n\n  let opacityWaving = 1;\n  let controlSchemeFrame = 0;\n  function animateFadeToSpriteChange() {\n    k.tween(\n      1,\n      0,\n      1,\n      (p) => (opacityWaving = p),\n      k.easings.easeInOutCubic,\n    ).onEnd(() => {\n      if (controlSchemeFrame == k.getSprite(\"inputs\").data.frames.length - 1) {\n        controlSchemeFrame = 0;\n      } else {\n        controlSchemeFrame += 1;\n      }\n      k.tween(\n        0,\n        1,\n        1,\n        (p) => (opacityWaving = p),\n        k.easings.easeInOutCubic,\n      ).onEnd(() => {\n        k.wait(3, () => {\n          animateFadeToSpriteChange();\n        });\n      });\n    });\n  }\n\n  k.wait(4, () => {\n    animateFadeToSpriteChange();\n  });\n\n  GameState.particles = k.add([\n    k.pos(k.center()),\n    k.layer(\"background\"),\n    k.z(2),\n    k.particles(\n      {\n        max: 100,\n        speed: [60, 80],\n        damping: [2.0, 3.0],\n        lifeTime: [0.85, 1.2],\n        angle: [0, 360],\n        texture: k.getSprite(\"hit\").data.tex, // texture of a sprite\n        quads: [\n          k.getSprite(\"hit\").data.frames[0],\n          k.getSprite(\"explode\").data.frames[1],\n          k.getSprite(\"explode\").data.frames[0],\n        ], // frames of a sprite\n      },\n      {\n        direction: 0,\n        spread: 360,\n      },\n    ),\n  ]);\n\n  k.onDraw(() => {\n    if (GameState.mode == \"start\") {\n      k.drawSprite({\n        sprite: \"TITLE\",\n        pos: k.vec2(k.center().x + 1, k.center().y + 10),\n        anchor: \"center\",\n      });\n\n      /*k.drawText({\n        text: \"CROWNFALL\",\n        anchor: \"center\",\n        align: \"center\",\n        pos: k.center(),\n        size: 32,\n        font: \"Alkhemikal\",\n        letterSpacing: -4,\n      });*/\n\n      k.drawSprite({\n        sprite: \"inputs\",\n        pos: k.vec2(k.center().x - 7.7, k.center().y + 34),\n        opacity: opacityWaving,\n        frame: controlSchemeFrame,\n        anchor: \"center\",\n      });\n\n      k.drawText({\n        text: \"Press     to shoot\",\n        anchor: \"center\",\n        align: \"center\",\n        pos: k.vec2(k.center().x, k.center().y + 34),\n        letterSpacing: -5,\n        //font: \"Menu\",\n        size: 14,\n      });\n\n      k.drawText({\n        text: \"by FABRIC VISIONS\",\n        anchor: \"center\",\n        align: \"center\",\n        pos: k.vec2(k.center().x, k.center().y + 92),\n        letterSpacing: -2.8,\n        size: 8,\n        opacity: 0.4,\n      });\n    } else if (GameState.mode == \"game\") {\n      //return;\n      k.drawText({\n        text: \"FLOOR\",\n        size: 6,\n        pos: k.vec2(\n          k.center().x + GameState.xOffset,\n          k.height() - GameState.yOffset - 8,\n        ),\n        anchor: \"center\",\n        align: \"center\",\n        font: \"Alkhemikal\",\n        letterSpacing: -1,\n      });\n\n      k.drawText({\n        text: toRoman(GameState.floor),\n        size: 10,\n        pos: k.vec2(\n          k.center().x + GameState.xOffset,\n          k.height() - GameState.yOffset,\n        ),\n        anchor: \"center\",\n        align: \"center\",\n        //font: \"Alkhemikal\",\n        letterSpacing: -3,\n      });\n\n      for (let i = 0; i < FloorState.totalRooms; i++) {\n        const x =\n          k.center().x +\n          GameState.xOffset -\n          14 / 2 +\n          (i * 14) / (FloorState.totalRooms - 1);\n        const y = k.height() - GameState.yOffset + 10;\n\n        k.drawRect({\n          width: 3,\n          height: 3,\n          pos: k.vec2(x, y),\n          anchor: \"center\",\n          opacity: i > FloorState.currentRoom ? 0.2 : 1,\n          fill: i > FloorState.currentRoom ? false : true,\n          outline: { width: 0.5, join: \"miter\" },\n        });\n      }\n\n      if (GameState.score > 0) {\n        // SCORE TEXT\n        k.drawText({\n          text: String(GameState.score).padStart(2, \"0\"),\n          size: 28,\n          pos: k.vec2(\n            k.center().x + GameState.xOffset,\n            k.height() - GameState.yOffset - 28,\n          ),\n          anchor: \"center\",\n          align: \"center\",\n          font: \"Numbers\",\n          letterSpacing: -18,\n        });\n\n        k.drawText({\n          text: \"SCORE\",\n          size: 8,\n          pos: k.vec2(\n            k.center().x + GameState.xOffset,\n            k.height() - GameState.yOffset - 16,\n          ),\n          anchor: \"center\",\n          align: \"center\",\n          letterSpacing: -2,\n          opacity: 0.5,\n        });\n      }\n    } else if (GameState.mode == \"over\") {\n      k.go(\"over\");\n    }\n  });\n});\n","import { k } from \"../kaplay\";\n\nk.scene(\"menu\", (opts) => {\n  k.onDraw(() => {\n    k.drawSprite({\n      sprite: \"TITLE\",\n      anchor: \"center\",\n      pos: k.vec2(k.center().x, k.center().y + 16),\n    });\n\n    k.drawText({\n      text: \"10   %\",\n      size: 10,\n      width: 120,\n      anchor: \"center\",\n      align: \"center\",\n      letterSpacing: -2,\n      pos: k.vec2(k.center().x, k.center().y - 16),\n    });\n  });\n});\n","import { k } from \"./kaplay\";\nimport { getOffsetPosition } from \"./utils/utils\";\nimport \"./scenes/game\";\nimport \"./scenes/menu\";\n\nexport const GameState = {\n  yOffset: getOffsetPosition(),\n  xOffset: 64,\n  xPosition: k.center().x,\n  spacing: 8,\n  tintColor: [244, 78, 56],\n  particles: null,\n  difficulty: \"hard\",\n  mode: \"start\",\n  score: 0,\n  highscore: 0,\n  enemiesBeaten: 0,\n  floor: 1,\n};\n\nk.setLayers([\"background\", \"game\", \"foreground\"], \"foreground\");\n\nk.onLoad(() => {\n  k.randSeed(Date.now());\n\n  k.go(\"game\");\n});\n"],"names":["colorPalettes","colorHistory","setTintColor","options","_","i","colorIndex","r","g","b","v","k","loadAssets","kaplay","progress","getOffsetPosition","defaultOffset","offset","maxDistance","playArea","areaDifference","toRoman","num","map","result","value","roman","restart","GameState","animateShakingObject","obj","duration","intensity","startX","t","angle","animateFloatingObject","backwards","animateSquashStretchObject","buildGUI","OPTIONS","number","maxNumber","mirror","dir","baseX","baseY","zigzagOffset","buildPlayer","object","sprite","collide","bullet","anim","DIFFICULTIES","getEnemyConfig","difficulty","rules","shieldSetup","spriteFrame","spriteFlip","newShield","shield","index","buildEnemy","onDeath","stats","timer","FloorState","setBackgroundPosition","wid","bg","bgPos","player","spawnEnemy","enemy","p","crown","shootProjectile","opacityWaving","controlSchemeFrame","animateFadeToSpriteChange","x","y","opts"],"mappings":"+uBAGA,MAAMA,EAAgB,CACpB,CAAC,IAAK,IAAK,GAAG,EACd,CAAC,IAAK,IAAK,EAAE,EACb,CAAC,IAAK,GAAI,EAAE,EACZ,CAAC,EAAG,IAAK,GAAG,EACZ,CAAC,IAAK,IAAK,GAAG,CAChB,EAEMC,EAAe,CAAA,EAEd,SAASC,GAAe,CAE7B,MAAMC,EAAUH,EACb,IAAI,CAACI,EAAGC,IAAMA,CAAC,EACf,OAAQ,GAAM,CAACJ,EAAa,SAAS,CAAC,CAAC,EAGpCK,EAAaH,EAAQ,KAAK,MAAM,KAAK,OAAM,EAAKA,EAAQ,MAAM,CAAC,EAGrEF,EAAa,KAAKK,CAAU,EACxBL,EAAa,OAAS,GAAGA,EAAa,MAAK,EAK/C,KAAM,CAACM,EAAGC,EAAGC,CAAC,EAAIT,EAAcM,CAAU,EAAE,IAAKI,GAAMA,EAAI,GAAG,EAE9DC,EAAE,cAAc,OAAQ,KAAO,CAC7B,QAASA,EAAE,IAAIJ,EAAGC,EAAGC,CAAC,CAC1B,EAAI,CACJ,CAEO,SAASG,GAAa,CAC3BD,EAAE,SAAS,IAAI,EAEfA,EAAE,WACA,OACA,KACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAWJ,EAEET,EAAY,EAEZS,EAAE,eAAe,aAAc,uBAAwB,GAAI,GAAI,CAC7D,OAAQ,UACR,MACE,mGACN,CAAG,EAEDA,EAAE,eAAe,WAAY,qBAAsB,GAAI,GAAI,CACzD,OAAQ,UACR,MACE,mGACN,CAAG,EAEDA,EAAE,eAAe,UAAW,mBAAoB,GAAI,GAAI,CACtD,OAAQ,UACR,MAAO,6BACX,CAAG,EAEDA,EAAE,eAAe,UAAW,wBAAyB,GAAI,GAAI,CAC3D,OAAQ,UACR,MACE,8EACN,CAAG,EAEDA,EAAE,SAAS,OAAQ,oBAAoB,EAEvCA,EAAE,WAAW,QAAS,mBAAmB,EAEzCA,EAAE,gBAAgB,+BAAgC,CAChD,OAAQ,CACN,EAAG,EACH,EAAG,EACH,MAAO,GACP,OAAQ,GACR,OAAQ,EACR,MAAO,CACL,KAAM,CACJ,KAAM,EACN,GAAI,EACJ,KAAM,GACN,MAAO,EACjB,CACA,CACA,CACA,CAAG,EAEDA,EAAE,gBAAgB,wBAAyB,CACzC,QAAS,CACP,EAAG,EACH,EAAG,EACH,MAAO,GACP,OAAQ,EACd,EACI,MAAO,CACL,EAAG,GACH,EAAG,EACH,MAAO,GACP,OAAQ,GACR,OAAQ,CACd,EACI,IAAK,CACH,EAAG,EACH,EAAG,GACH,MAAO,GACP,OAAQ,EACd,EACI,OAAQ,CACN,EAAG,GACH,EAAG,EACH,MAAO,GACP,OAAQ,GACR,OAAQ,CACN,KAAM,EACN,MAAO,EACP,IAAK,EACL,OAAQ,CAChB,CACA,EACI,QAAS,CACP,EAAG,GACH,EAAG,GACH,MAAO,GACP,OAAQ,EACd,EACI,OAAQ,CACN,EAAG,EACH,EAAG,GACH,MAAO,GACP,OAAQ,GACR,OAAQ,CACd,CACA,CAAG,EAEDA,EAAE,gBAAgB,sBAAuB,CACvC,KAAM,CACJ,EAAG,GACH,EAAG,EACH,MAAO,GACP,OAAQ,EACd,EACI,MAAO,CACL,EAAG,EACH,EAAG,EACH,MAAO,GACP,OAAQ,EACd,EACI,OAAQ,CACN,EAAG,EACH,EAAG,GACH,MAAO,GACP,OAAQ,GACR,OAAQ,EACR,OAAQ,CACd,CACA,CAAG,EAEDA,EAAE,gBAAgB,uBAAwB,CACxC,QAAS,CACP,EAAG,EACH,EAAG,EACH,MAAO,GACP,OAAQ,GACR,OAAQ,EACR,MAAO,CACL,KAAM,CACJ,KAAM,EACN,GAAI,EACJ,MAAO,EACjB,CACA,CACA,EACI,IAAK,CACH,EAAG,EACH,EAAG,GACH,MAAO,GACP,OAAQ,GACR,OAAQ,EACR,MAAO,CACL,KAAM,CACJ,KAAM,EACN,GAAI,EACJ,MAAO,EACjB,CACA,CACA,EACI,SAAU,CACR,EAAG,GACH,EAAG,GACH,MAAO,GACP,OAAQ,GACR,OAAQ,CACd,CACA,CAAG,EAEDA,EAAE,WAAW,MAAO,iCAAiC,EACrDA,EAAE,UAAU,QAAS,sBAAsB,CAC7C,CC/MO,MAAMA,EAAIE,EAAO,CACtB,OAAQ,GAGR,MAAO,EACP,KAAM,WACN,MAAO,GACP,UAAW,UACX,cAAe,GACf,WAAY,CAAC,GAAI,GAAI,EAAE,EACvB,MAAO,GACP,QAAS,CACP,QAAS,CACP,SAAU,CAAC,IAAK,IAAI,EACpB,QAAS,CAAC,OAAO,EACjB,MAAO,CAAC,MAAM,CACpB,EACI,UAAW,CACT,SAAU,CAAC,IAAK,MAAM,EACtB,QAAS,CAAC,MAAM,EAChB,MAAO,CAAC,OAAO,CACrB,CACA,CACA,CAAC,EAEDD,EAAU,EAEVD,EAAE,UAAWG,GAAa,CAOxBH,EAAE,SAAS,CACT,MAAO,KAAK,MAAMG,CAAQ,EAAI,MAAM,SAAQ,EAC5C,KAAM,GACN,MAAO,IACP,OAAQ,SACR,MAAO,SACP,cAAe,GACf,IAAKH,EAAE,OAAM,EACb,MAAOA,EAAE,KACb,CAAG,CACH,CAAC,EC/CM,SAASI,EAAkBC,EAAgB,GAAI,CACpD,IAAIC,EAASD,EAEb,MAAME,EAAc,IACdC,EAAWR,EAAE,OAAM,EAAKM,EAAS,EAEvC,GAAIE,EAAWD,EAAa,CAC1B,MAAME,EAAiBD,EAAWD,EAElCD,EAASA,EAASG,EAAiB,CACrC,CAEA,OAAOH,CACT,CAEO,SAASI,EAAQC,EAAK,CAC3B,MAAMC,EAAM,CACV,CAAC,IAAM,GAAG,EACV,CAAC,IAAK,IAAI,EACV,CAAC,IAAK,GAAG,EACT,CAAC,IAAK,IAAI,EACV,CAAC,IAAK,GAAG,EACT,CAAC,GAAI,IAAI,EACT,CAAC,GAAI,GAAG,EACR,CAAC,GAAI,IAAI,EACT,CAAC,GAAI,GAAG,EACR,CAAC,EAAG,IAAI,EACR,CAAC,EAAG,GAAG,EACP,CAAC,EAAG,IAAI,EACR,CAAC,EAAG,GAAG,CACX,EAEE,IAAIC,EAAS,GACb,SAAW,CAACC,EAAOC,CAAK,IAAKH,EAC3B,KAAOD,GAAOG,GACZD,GAAUE,EACVJ,GAAOG,EAGX,OAAOD,CACT,CCvCAb,EAAE,MAAM,OAAQ,IAAM,CACpB,MAAMgB,EAAUhB,EAAE,IAAI,CACpBA,EAAE,OAAO,SAAS,EAClBA,EAAE,IAAIA,EAAE,OAAM,EAAG,EAAGA,EAAE,OAAM,EAAG,EAAI,EAAE,EACrCA,EAAE,OAAO,QAAQ,EACjBA,EAAE,KAAI,EACNA,EAAE,MAAM,YAAY,EACpB,SACJ,CAAG,EAEGiB,EAAU,MAAQA,EAAU,YAC9BA,EAAU,UAAYA,EAAU,OAElCD,EAAQ,QAAQ,IAAM,CACpBC,EAAU,MAAQ,EAClBA,EAAU,KAAO,QACjBjB,EAAE,GAAG,MAAM,CACb,CAAC,EAWDA,EAAE,OAAO,IAAM,CACbA,EAAE,SAAS,CACT,MAAO,IACP,OAAQ,IACR,IAAKA,EAAE,OAAM,EACb,OAAQ,SACR,KAAM,GACN,QAAS,CAAE,MAAOA,EAAE,MAAO,MAAO,IAAK,KAAM,OAAO,CAC1D,CAAK,EAEDA,EAAE,WAAW,CACX,OAAQ,MACR,MAAO,GACP,OAAQ,GACR,IAAKA,EAAE,KAAKA,EAAE,OAAM,EAAG,EAAGA,EAAE,SAAS,EAAI,EAAE,EAC3C,OAAQ,QACd,CAAK,EAEDA,EAAE,SAAS,CACT,KAAM,YACN,KAAM,aACN,OAAQ,SACR,MAAO,SACP,IAAKA,EAAE,KAAKA,EAAE,OAAM,EAAG,EAAGA,EAAE,SAAS,EAAI,EAAE,EAC3C,cAAe,GACf,KAAM,EACZ,CAAK,EAEDA,EAAE,SAAS,CACT,KAAM,UAAYiB,EAAU,MAC5B,OAAQ,SACR,MAAO,SACP,IAAKjB,EAAE,KAAKA,EAAE,OAAM,EAAG,EAAGA,EAAE,SAAS,EAAI,EAAE,EAC3C,cAAe,GACf,KAAM,EACZ,CAAK,EAEDA,EAAE,SAAS,CACT,KAAM,cAAgBiB,EAAU,UAChC,OAAQ,SACR,MAAO,SACP,IAAKjB,EAAE,OAAM,EACb,cAAe,GACf,KAAM,EACZ,CAAK,EAEDA,EAAE,SAAS,CACT,KAAM,UAAYiB,EAAU,cAC5B,OAAQ,SACR,MAAO,SACP,IAAKjB,EAAE,KAAKA,EAAE,OAAM,EAAG,EAAGA,EAAE,SAAS,EAAI,EAAE,EAC3C,cAAe,GACf,KAAM,EACZ,CAAK,EAGDA,EAAE,SAAS,CACT,MAAO,GACP,OAAQ,GACR,IAAKA,EAAE,KAAKA,EAAE,OAAM,EAAG,EAAGA,EAAE,SAAS,EAAI,EAAE,EAC3C,OAAQ,SACR,KAAM,GACN,QAAS,CAAE,MAAOA,EAAE,MAAO,MAAO,EAAG,KAAM,OAAO,CACxD,CAAK,EAEDA,EAAE,SAAS,CACT,KAAM,oBACN,OAAQ,SACR,MAAO,SACP,IAAKA,EAAE,KAAKA,EAAE,OAAM,EAAG,EAAGA,EAAE,SAAS,EAAI,EAAE,EAC3C,cAAe,KACf,KAAM,EACN,QAAS,EACf,CAAK,CACH,CAAC,CACH,CAAC,EC3FM,SAASkB,EAAqBC,EAAKC,EAAW,GAAKC,EAAY,EAAG,CACvE,MAAMC,EAASH,EAAI,IAAI,EAEvBA,EAAI,MACF,EACA,EACAC,EACCG,GAAM,CAGL,MAAMC,EAAQD,EAAI,GAAK,KAAK,GAAK,EAAIH,EACrCD,EAAI,IAAI,EAAIG,EAAS,KAAK,IAAIE,CAAK,EAAIH,CACzC,EACArB,EAAE,QAAQ,YACd,CACA,CAEO,SAASyB,EAAsBN,EAAKO,EAAY,GAAO,CAC5DP,EAAI,QAAQ,MAAO,CAACnB,EAAE,KAAK,CAAC,EAAGA,EAAE,KAAK,EAAG0B,EAAY,EAAI,EAAE,CAAC,EAAG,CAC7D,SAAU,EACV,UAAW,YACX,OAAQ1B,EAAE,QAAQ,aACtB,CAAG,CACH,CAEO,SAAS2B,EAA2BR,EAAK,CAC9CA,EAAI,MACFnB,EAAE,KAAK,GAAK,GAAG,EACfA,EAAE,KAAK,CAAC,EACR,EACCc,GAAU,CACTK,EAAI,MAAQL,CACd,EACAd,EAAE,QAAQ,cACd,CACA,CC/CO,SAAS4B,EAASC,EAASC,EAAQC,EAAWC,EAAS,GAAO,CACnE,MAAMC,EAAMD,EAAS,GAAK,EAE1BhC,EAAE,WAAW,CACX,OAAQ,UACR,IAAKA,EAAE,KAAK6B,EAAQ,QAAUI,EAAK,CAAC,EACpC,OAAQ,SACR,MAAOD,CACX,CAAG,EAWDhC,EAAE,SAAS,CACT,KAAM8B,EAAO,SAAQ,EACrB,KAAM,GACN,IAAK9B,EAAE,KAAK6B,EAAQ,QAAUI,EAAM,GAAK,GAAI,EAC7C,OAAQ,SACR,MAAO,SACP,KAAM,UACN,cAAe,GACnB,CAAG,EAGD,QAAS,EAAI,EAAG,EAAIF,EAAW,IAAK,CAElC,MAAMG,EAAQD,GAAOJ,EAAQ,QAAU,IACjCM,EAAQ,EAAIN,EAAQ,QAAU,EAG9BO,EAAe,EAAI,IAAM,EAAI,EAAIP,EAAQ,QAE/C7B,EAAE,WAAW,CACX,OAAQ,QACR,MAAO,EAAI8B,EAAUE,EAAS,EAAI,EAAK,EACvC,QAAS,EAAIF,EAAS,EAAI,GAC1B,IAAK9B,EAAE,KAAKkC,EAAQD,EAAMG,EAAcH,EAAME,CAAK,EACnD,OAAQ,QAEd,CAAK,CACH,CACF,CCzCO,SAASE,GAAc,CAE5B,MAAMC,EAAStC,EAAE,IAAI,CACnBA,EAAE,IAAIiB,EAAU,UAAWjB,EAAE,OAAM,EAAKiB,EAAU,OAAO,EACzDjB,EAAE,OAAO,QAAQ,EACjB,CACE,QAAS,GACT,SAAU,GACV,YAAa,GACb,YAAa,EACb,KAAM,EACN,QAAS,CACf,EACI,QACJ,CAAG,EAEDsC,EAAO,QAAUA,EAAO,KAGxB,MAAMC,EAASD,EAAO,IAAI,CACxBtC,EAAE,OAAO,MAAM,EACfA,EAAE,IAAG,EACLA,EAAE,QAAQ,CAAE,SAAU,EAAI,CAAE,EAC5BA,EAAE,OAAO,QAAQ,EACjBA,EAAE,MAAK,EACPA,EAAE,MAAM,MAAM,EACdA,EAAE,EAAE,CAAC,CACT,CAAG,EAED,OAAAyB,EAAsBc,CAAM,EAG5BD,EAAO,OAAO,IAAM,CACdrB,EAAU,OAAS,QAEvBW,EAASX,EAAWqB,EAAO,KAAMA,EAAO,QAAS,EAAI,CACvD,CAAC,EAIDA,EAAO,MAAQ,IAAM,CACnB,GAAIA,EAAO,KAAO,GAAKA,EAAO,SAAU,CAsBtC,IAASE,EAAT,UAAmB,CACjBC,EAAO,MAAM,MAAM,EACnBA,EAAO,EAEPA,EAAO,OAAS,MAChBA,EAAO,KAAK,MAAM,EAElBA,EAAO,UAAWC,GAAS,CACzBD,EAAO,QAAO,CAChB,CAAC,CACH,EA/BAH,EAAO,MAAQ,EACfA,EAAO,SAAW,GAElBtC,EAAE,KAAK,GAAMsC,EAAO,YAAa,IAAM,CACrCA,EAAO,SAAW,EACpB,CAAC,EAEDC,EAAO,UAAU,KAAK,EACtBZ,EAA2BY,CAAM,EAEjC,MAAME,EAASzC,EAAE,IAAI,CACnBA,EAAE,IAAIsC,EAAO,GAAG,EAChBtC,EAAE,OAAO,SAAU,CAAE,KAAM,MAAM,CAAE,EACnCA,EAAE,KAAK,CAAE,MAAO,EAAG,CAAE,EACrBA,EAAE,UAAU,CAAE,QAAS,EAAI,CAAE,EAC7BA,EAAE,OAAO,QAAQ,EACjBA,EAAE,KAAKA,EAAE,GAAIsC,EAAO,YAAc,EAAE,EACpCtC,EAAE,MAAM,MAAM,EACd,QACR,CAAO,EAcDyC,EAAO,UAAU,SAAU,IAAM,CAC/BD,EAAO,CACT,CAAC,EAEDC,EAAO,UAAU,QAAS,IAAM,CAC9BD,EAAO,CACT,CAAC,EAEDf,EAAsBc,CAAM,CAC9B,CACF,EAEOD,CACT,CC9FA,MAAMK,EAAe,CACnB,KAAM,CACJ,OAAQ,IAAM,EACd,QAAS,IAAM,EACf,OAAQ,IAAM,GACd,MAAO,IAAM,GACb,MAAO,IAAM3C,EAAE,MAAM,EAAG,EAAE,CAC9B,EACE,KAAM,CACJ,OAAQ,IAAMA,EAAE,MAAM,EAAG,CAAC,EAC1B,QAAS,IAAMA,EAAE,MAAM,EAAG,CAAC,EAC3B,OAAQ,IAAM,GACd,MAAO,IAAMA,EAAE,KAAK,IAAM,EAAG,EAC7B,MAAO,IAAM,CACjB,EACE,OAAQ,CACN,OAAQ,IAAMA,EAAE,MAAM,EAAG,CAAC,EAC1B,QAAS,IAAMA,EAAE,MAAM,EAAG,CAAC,EAC3B,OAAQ,IAAM,GACd,MAAO,IAAMA,EAAE,KAAK,IAAK,GAAG,EAC5B,MAAO,IAAMA,EAAE,MAAM,EAAG,CAAC,CAC7B,EACE,KAAM,CACJ,OAAQ,IAAMA,EAAE,MAAM,EAAG,CAAC,EAC1B,QAAS,IAAMA,EAAE,MAAM,EAAG,CAAC,EAC3B,OAAQ,IAAM,GACd,MAAO,IAAMA,EAAE,KAAK,IAAK,GAAG,EAC5B,MAAO,IAAMA,EAAE,MAAM,EAAG,EAAE,CAC9B,EACE,UAAW,CACT,OAAQ,IAAMA,EAAE,MAAM,EAAG,EAAE,EAC3B,QAAS,IAAMA,EAAE,MAAM,EAAG,CAAC,EAC3B,OAAQ,IAAM,GACd,MAAO,IAAMA,EAAE,KAAK,IAAK,GAAG,EAC5B,MAAO,IAAM,EACjB,CACA,EAEO,SAAS4C,EAAeC,EAAa,OAAQ,CAClD,MAAMC,EAAQH,EAAaE,CAAU,EAErC,MAAO,CACL,OAAQC,EAAM,OAAM,EACpB,QAASA,EAAM,QAAO,EACtB,OAAQA,EAAM,OAAM,EACpB,MAAOA,EAAM,MAAK,EAClB,MAAOA,EAAM,MAAK,CACtB,CACA,CChDO,SAASC,EAAYT,EAAQ,CAClC,MAAMU,EAAchD,EAAE,MAAM,CAAC,EACvBiD,EAAaD,GAAe,GAAKhD,EAAE,OAAS,GAIlD,QAASN,EAAI,EAAGA,EAAI4C,EAAO,QAAS5C,IAAK,CACvC,MAAMwD,EAAYlD,EAAE,IAAI,CACtBA,EAAE,OAAO,SAAU,CACjB,MAAOgD,EACP,MAAOC,CACf,CAAO,EACDjD,EAAE,OAAO,QAAQ,EACjBA,EAAE,KAAK,CAAE,MAAOA,EAAE,KAAK,GAAK,EAAG,EAAG,OAAQA,EAAE,KAAK,EAAG,GAAG,CAAC,CAAE,EAC1DA,EAAE,IAAIsC,EAAO,GAAG,EAChBtC,EAAE,MAAK,EACPA,EAAE,MAAM,MAAM,EACdA,EAAE,EAAE,CAAC,EACL,QACN,CAAK,EAEDkD,EAAU,UAAU,SAAU,IAAM,CAClCvB,EAA2BuB,CAAS,CACtC,CAAC,EAEDZ,EAAO,eAAe,KAAK,CAAE,OAAQY,EAAW,MAAOxD,EAAG,CAC5D,CAEA4C,EAAO,SAAS,IAAM,CACpB,GAAI,CAACA,EAAO,IAAI,QAAQ,EAAG,OAC3B,MAAMf,EAAIvB,EAAE,KAAI,EAAKsC,EAAO,MAAQA,EAAO,UAC3CA,EAAO,eAAe,QAAQ,CAAC,CAAE,OAAAa,EAAQ,MAAAC,CAAK,EAAI1D,IAAM,CACtD,MAAM8B,EAAU,EAAI,KAAK,GAAMc,EAAO,QAAW5C,EAAI6B,EACrD,IAAIjB,EAASN,EAAE,KACb,KAAK,IAAIwB,CAAK,EAAIc,EAAO,OACzB,KAAK,IAAId,CAAK,EAAIc,EAAO,MACjC,EACMa,EAAO,OAAOb,EAAO,IAAI,EAAIhC,EAAO,EAAGgC,EAAO,IAAI,EAAIhC,EAAO,CAAC,CAChE,CAAC,CACH,CAAC,EAEDgC,EAAO,QAAQ,IAAM,CACnBA,EAAO,eAAe,QAAQ,CAAC,CAAE,OAAAa,CAAM,EAAIzD,IAAM,CAC/CM,EAAE,KAAK,GAAMN,EAAG,IAAM,CACpByD,EAAO,OAAS,UAChBA,EAAO,KAAK,MAAM,EAElBA,EAAO,UAAWT,GAAS,CACzBS,EAAO,QAAO,CAChB,CAAC,CACH,CAAC,CACH,CAAC,CACH,CAAC,CACH,CC7CO,SAASE,EAAW,CAAE,QAAAC,CAAO,EAAK,GAAI,CAC3C,MAAMC,EAAQX,EAAe3B,EAAU,UAAU,EAG3CqB,EAAStC,EAAE,IAAI,CACnBA,EAAE,OAAOuD,EAAM,MAAM,EACrBvD,EAAE,IAAIiB,EAAU,UAAWA,EAAU,QAAU,CAAC,EAChDjB,EAAE,KAAK,CAAE,MAAO,IAAIA,EAAE,KAAKA,EAAE,KAAK,CAAC,EAAG,GAAI,EAAE,CAAC,CAAE,EAC/CA,EAAE,OAAO,QAAQ,EACjB,CACE,QAASuD,EAAM,QACf,OAAQA,EAAM,OACd,MAAOA,EAAM,MACb,MAAOA,EAAM,MACb,UAAWvD,EAAE,KAAI,EAAK,GAAM,EAAI,GAChC,eAAgB,CAAA,CACtB,EACIA,EAAE,MAAM,MAAM,EACd,OACJ,CAAG,EAGKuC,EAASD,EAAO,IAAI,CACxBtC,EAAE,OAAO,OAAO,EAChBA,EAAE,IAAG,EACLA,EAAE,OAAO,QAAQ,EACjBA,EAAE,QAAQ,CAAE,SAAU,EAAI,CAAE,EAC5BA,EAAE,MAAK,EACPA,EAAE,MAAM,MAAM,EACdA,EAAE,EAAE,CAAC,CACT,CAAG,EAED,OAAAyB,EAAsBc,EAAQ,EAAI,EAGlCD,EAAO,OAAO,IAAM,CACdrB,EAAU,OAAS,QAAU,CAACqB,EAAO,IAAI,QAAQ,GAErDV,EAASX,EAAWqB,EAAO,GAAIA,EAAO,KAAK,CAC7C,CAAC,EAEDS,EAAYT,CAAM,EAElBA,EAAO,UAAU,SAAU,IAAM,CAC/BpB,EAAqBqB,CAAM,EAC3BZ,EAA2BY,CAAM,EACjCD,EAAO,IAAM,CACf,CAAC,EAEDA,EAAO,QAAQ,IAAM,CACnBA,EAAO,MAAM,QAAQ,EACrBtC,EAAE,MAAM,CAAC,EAET,MAAMwD,EAAQ,IAAOlB,EAAO,eAAe,OAAS,EAEpDpB,EAAqBqB,EAAQiB,EAAO,CAAC,EAErCvC,EAAU,UAAU,IAAMqB,EAAO,IACjCtC,EAAE,KACA,IACA,IAAM,CACJiB,EAAU,UAAU,KAAK,CAAC,CAC5B,EACAqB,EAAO,eAAe,OAAS,CACrC,EAEItC,EAAE,KAAKwD,EAAO,IAAM,CACdF,GAASA,EAAQhB,CAAM,EAC3BA,EAAO,QAAO,CAChB,CAAC,CACH,CAAC,EAEMA,CACT,CC5EA,MAAMmB,EAAa,CAEjB,YAAa,EACb,WAAYzD,EAAE,MAAM,EAAG,CAAC,CAC1B,EAEAA,EAAE,MAAM,OAAQ,IAAM,CACpB,SAAS0D,GAAwB,CAC/B,OAAO1D,EAAE,KAAKA,EAAE,MAAM,EAAG,GAAK2D,EAAM,CAAC,EAAG3D,EAAE,MAAM,EAAG,GAAK2D,EAAM,CAAC,CAAC,CAClE,CAEA,IAAIC,EAAK,MACT,MAAMD,EAAM,KAAK,MAAM3D,EAAE,MAAK,EAAK,GAAK,CAAC,EACzC,IAAI6D,EAAQH,EAAqB,EAEtB1D,EAAE,IAAI,CAACA,EAAE,MAAM,YAAY,CAAC,CAAC,EAErC,OAAO,IAAM,CACdA,EAAE,WAAW,CACX,OAAQ4D,EAAG,SAAQ,EACnB,IAAK5D,EAAE,KAAK6D,EAAM,EAAI,IAAKA,EAAM,EAAI,GAAG,CAE9C,CAAK,CACH,CAAC,EAED,MAAMC,EAASzB,EAAW,EAC1ByB,EAAO,SAAW,GAElB,SAASC,GAAa,CACNV,EAAW,CACvB,QAAUW,GAAU,CAClBP,EAAW,aAAe,EAC1BxC,EAAU,eAAiB,EAGvBwC,EAAW,aAAeA,EAAW,aACvCA,EAAW,YAAc,EACzBxC,EAAU,OAAS,EACnBwC,EAAW,WAAazD,EAAE,MAAM,EAAG,CAAC,GAItCA,EAAE,MACAiB,EAAU,MACTA,EAAU,OAAS+C,EAAM,MAC1B,EACCC,GAAOhD,EAAU,MAAQ,KAAK,KAAKgD,CAAC,EACrCjE,EAAE,QAAQ,YACpB,EAEQA,EAAE,KAAK,IAAM,IAAM,CACjBA,EAAE,OAAO,CAAC,EACV6D,EAAQH,EAAqB,EAC7BnE,EAAY,EACZwE,EAAU,CACZ,CAAC,CACH,CACN,CAAK,CACH,CAEAA,EAAU,EAEV/D,EAAE,UAAU,QAAS,SAAU,CAACkE,EAAOzB,IAAW,CAChDzC,EAAE,MAAM,CAAC,EACT8D,EAAO,MAAQ,CACjB,CAAC,EAED9D,EAAE,UAAU,SAAU,SAAU,CAACmD,EAAQV,IAAW,CAClDzC,EAAE,MAAM,CAAC,CACX,CAAC,EAEDA,EAAE,SAAS,IAAM,CACX8D,EAAO,OAAS,GAAK9D,EAAE,IAAI,QAAQ,EAAE,QAAU,GAAK8D,EAAO,UAI7DA,EAAO,QAAU,GACjB9D,EAAE,MAAM,CAAC,EACTiB,EAAU,UAAU,IAAM6C,EAAO,IAEjC9D,EAAE,KACA,GACA,IAAM,CACJiB,EAAU,UAAU,KAAK,CAAC,CAC5B,EACA,CACR,EAAQ,MAAM,IAAM,CACZA,EAAU,KAAO,MACnB,CAAC,EAEL,CAAC,EAED,SAASkD,GAAkB,CACrBlD,EAAU,OAAS,SACrBA,EAAU,KAAO,OACjBjB,EAAE,KAAK,QAAS,CAAE,KAAM,EAAI,CAAE,GAE9B8D,EAAO,MAAK,CAEhB,CAIA9D,EAAE,cAAc,YAAa,IAAM,CAWnC,CAAC,EAEDA,EAAE,aAAa,UAAW,IAAM,CAC9BmE,EAAe,CACjB,CAAC,EAED,IAAIC,EAAgB,EAChBC,EAAqB,EACzB,SAASC,GAA4B,CACnCtE,EAAE,MACA,EACA,EACA,EACCiE,GAAOG,EAAgBH,EACxBjE,EAAE,QAAQ,cAChB,EAAM,MAAM,IAAM,CACRqE,GAAsBrE,EAAE,UAAU,QAAQ,EAAE,KAAK,OAAO,OAAS,EACnEqE,EAAqB,EAErBA,GAAsB,EAExBrE,EAAE,MACA,EACA,EACA,EACCiE,GAAOG,EAAgBH,EACxBjE,EAAE,QAAQ,cAClB,EAAQ,MAAM,IAAM,CACZA,EAAE,KAAK,EAAG,IAAM,CACdsE,EAAyB,CAC3B,CAAC,CACH,CAAC,CACH,CAAC,CACH,CAEAtE,EAAE,KAAK,EAAG,IAAM,CACdsE,EAAyB,CAC3B,CAAC,EAEDrD,EAAU,UAAYjB,EAAE,IAAI,CAC1BA,EAAE,IAAIA,EAAE,QAAQ,EAChBA,EAAE,MAAM,YAAY,EACpBA,EAAE,EAAE,CAAC,EACLA,EAAE,UACA,CACE,IAAK,IACL,MAAO,CAAC,GAAI,EAAE,EACd,QAAS,CAAC,EAAK,CAAG,EAClB,SAAU,CAAC,IAAM,GAAG,EACpB,MAAO,CAAC,EAAG,GAAG,EACd,QAASA,EAAE,UAAU,KAAK,EAAE,KAAK,IACjC,MAAO,CACLA,EAAE,UAAU,KAAK,EAAE,KAAK,OAAO,CAAC,EAChCA,EAAE,UAAU,SAAS,EAAE,KAAK,OAAO,CAAC,EACpCA,EAAE,UAAU,SAAS,EAAE,KAAK,OAAO,CAAC,CAC9C,CACA,EACM,CACE,UAAW,EACX,OAAQ,GAChB,CACA,CACA,CAAG,EAEDA,EAAE,OAAO,IAAM,CACb,GAAIiB,EAAU,MAAQ,QACpBjB,EAAE,WAAW,CACX,OAAQ,QACR,IAAKA,EAAE,KAAKA,EAAE,OAAM,EAAG,EAAI,EAAGA,EAAE,SAAS,EAAI,EAAE,EAC/C,OAAQ,QAChB,CAAO,EAYDA,EAAE,WAAW,CACX,OAAQ,SACR,IAAKA,EAAE,KAAKA,EAAE,OAAM,EAAG,EAAI,IAAKA,EAAE,SAAS,EAAI,EAAE,EACjD,QAASoE,EACT,MAAOC,EACP,OAAQ,QAChB,CAAO,EAEDrE,EAAE,SAAS,CACT,KAAM,qBACN,OAAQ,SACR,MAAO,SACP,IAAKA,EAAE,KAAKA,EAAE,OAAM,EAAG,EAAGA,EAAE,SAAS,EAAI,EAAE,EAC3C,cAAe,GAEf,KAAM,EACd,CAAO,EAEDA,EAAE,SAAS,CACT,KAAM,oBACN,OAAQ,SACR,MAAO,SACP,IAAKA,EAAE,KAAKA,EAAE,OAAM,EAAG,EAAGA,EAAE,SAAS,EAAI,EAAE,EAC3C,cAAe,KACf,KAAM,EACN,QAAS,EACjB,CAAO,UACQiB,EAAU,MAAQ,OAAQ,CAEnCjB,EAAE,SAAS,CACT,KAAM,QACN,KAAM,EACN,IAAKA,EAAE,KACLA,EAAE,OAAM,EAAG,EAAIiB,EAAU,QACzBjB,EAAE,OAAM,EAAKiB,EAAU,QAAU,CAC3C,EACQ,OAAQ,SACR,MAAO,SACP,KAAM,aACN,cAAe,EACvB,CAAO,EAEDjB,EAAE,SAAS,CACT,KAAMU,EAAQO,EAAU,KAAK,EAC7B,KAAM,GACN,IAAKjB,EAAE,KACLA,EAAE,OAAM,EAAG,EAAIiB,EAAU,QACzBjB,EAAE,SAAWiB,EAAU,OACjC,EACQ,OAAQ,SACR,MAAO,SAEP,cAAe,EACvB,CAAO,EAED,QAASvB,EAAI,EAAGA,EAAI+D,EAAW,WAAY/D,IAAK,CAC9C,MAAM6E,EACJvE,EAAE,OAAM,EAAG,EACXiB,EAAU,QACV,EACCvB,EAAI,IAAO+D,EAAW,WAAa,GAChCe,EAAIxE,EAAE,OAAM,EAAKiB,EAAU,QAAU,GAE3CjB,EAAE,SAAS,CACT,MAAO,EACP,OAAQ,EACR,IAAKA,EAAE,KAAKuE,EAAGC,CAAC,EAChB,OAAQ,SACR,QAAS9E,EAAI+D,EAAW,YAAc,GAAM,EAC5C,KAAM,EAAA/D,EAAI+D,EAAW,aACrB,QAAS,CAAE,MAAO,GAAK,KAAM,OAAO,CAC9C,CAAS,CACH,CAEIxC,EAAU,MAAQ,IAEpBjB,EAAE,SAAS,CACT,KAAM,OAAOiB,EAAU,KAAK,EAAE,SAAS,EAAG,GAAG,EAC7C,KAAM,GACN,IAAKjB,EAAE,KACLA,EAAE,OAAM,EAAG,EAAIiB,EAAU,QACzBjB,EAAE,OAAM,EAAKiB,EAAU,QAAU,EAC7C,EACU,OAAQ,SACR,MAAO,SACP,KAAM,UACN,cAAe,GACzB,CAAS,EAEDjB,EAAE,SAAS,CACT,KAAM,QACN,KAAM,EACN,IAAKA,EAAE,KACLA,EAAE,OAAM,EAAG,EAAIiB,EAAU,QACzBjB,EAAE,OAAM,EAAKiB,EAAU,QAAU,EAC7C,EACU,OAAQ,SACR,MAAO,SACP,cAAe,GACf,QAAS,EACnB,CAAS,EAEL,MAAWA,EAAU,MAAQ,QAC3BjB,EAAE,GAAG,MAAM,CAEf,CAAC,CACH,CAAC,ECpTDA,EAAE,MAAM,OAASyE,GAAS,CACxBzE,EAAE,OAAO,IAAM,CACbA,EAAE,WAAW,CACX,OAAQ,QACR,OAAQ,SACR,IAAKA,EAAE,KAAKA,EAAE,OAAM,EAAG,EAAGA,EAAE,SAAS,EAAI,EAAE,CACjD,CAAK,EAEDA,EAAE,SAAS,CACT,KAAM,SACN,KAAM,GACN,MAAO,IACP,OAAQ,SACR,MAAO,SACP,cAAe,GACf,IAAKA,EAAE,KAAKA,EAAE,OAAM,EAAG,EAAGA,EAAE,SAAS,EAAI,EAAE,CACjD,CAAK,CACH,CAAC,CACH,CAAC,ECfM,MAAMiB,EAAY,CACvB,QAASb,EAAiB,EAC1B,QAAS,GACT,UAAWJ,EAAE,OAAM,EAAG,EACtB,QAAS,EAET,UAAW,KACX,WAAY,OACZ,KAAM,QACN,MAAO,EACP,UAAW,EACX,cAAe,EACf,MAAO,CACT,EAEAA,EAAE,UAAU,CAAC,aAAc,OAAQ,YAAY,EAAG,YAAY,EAE9DA,EAAE,OAAO,IAAM,CACbA,EAAE,SAAS,KAAK,KAAK,EAErBA,EAAE,GAAG,MAAM,CACb,CAAC"}